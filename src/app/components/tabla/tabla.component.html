<div class="container">
  <div class="centered-element">
      <p-table [value]="products" stripedRows showGridlines showGridlines [resizableColumns]="true" [scrollable]="true" scrollHeight="500px" columnResizeMode="expand" dataKey="idOperationalActivity" editMode="row">
      <ng-template pTemplate="header">
        <tr>
          <th>Código de actividad</th>
          <th>Nombre de actividad</th>
          <th>Unidad de medida</th>
          <th>Objetivo estratégico</th>
          <th>Acción estratégica</th>
          <th></th> <th>Fondo financiero</th>
          <th>Centro gestor</th>
          <th>Centro de costos</th>
          <th>Tipo de medida</th>
          <th>Prioridad</th>
          <!-- <th>Meta esperada</th>
          <th>Meta ejecutada</th> -->
          <th>Bienes</th>
          <th>Remuneraciones</th>
          <th>Servicios</th>
          <th>Trimestre I</th>
          <th>Trimestre II</th>
          <th>Trimestre III</th>
          <th>Trimestre IV</th>
          <th>Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product let-editing="editing" let-ri="rowIndex">
        <tr [pEditableRow]="product">
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.sapCode" type="text" [disabled]="true" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.sapCode }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.name" type="text" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.name }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.measurementUnit" type="text" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.measurementUnit }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [ngModel]="getStrategicObjectiveCodeDisplay(product.strategicAction?.strategicObjective?.idStrategicObjective)" type="text" [disabled]="true" />
              </ng-template>
              <ng-template pTemplate="output">
                {{ getStrategicObjectiveCodeDisplay(product.strategicAction?.strategicObjective?.idStrategicObjective) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [ngModel]="getStrategicActionCodeDisplay(product.strategicAction?.idStrategicAction)" type="text" [disabled]="true" />
              </ng-template>
              <ng-template pTemplate="output">
                {{ getStrategicActionCodeDisplay(product.strategicAction?.idStrategicAction) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td> <p-cellEditor *ngIf="editing">
              <ng-template pTemplate="input">
                <button
                  pButton
                  type="button"
                  icon="pi pi-search"
                  (click)="openOeAeSelectionModal(product)"
                  label="Seleccionar"
                  [disabled]="state === 3"
                  class="p-button-sm">
                </button>
              </ng-template>
              <ng-template pTemplate="output"></ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="financialFunds"
                  optionLabel="name"
                  optionValue="idFinancialFund"
                  [(ngModel)]="product.financialFund.idFinancialFund"
                  [style]="{ width: '100%' }"
                  [disabled]="state === 3"> </p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ getFinancialFundName(product.financialFund?.idFinancialFund) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="managementCenters"
                  optionLabel="name"
                  optionValue="idManagementCenter"
                  [(ngModel)]="product.managementCenter.idManagementCenter"
                  [style]="{ width: '100%' }"
                  [disabled]="state === 3"> </p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ getManagementCenterName(product.managementCenter?.idManagementCenter) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="costCenters"
                  optionLabel="name"
                  optionValue="idCostCenter"
                  [(ngModel)]="product.costCenter.idCostCenter"
                  [style]="{ width: '100%' }"
                  [disabled]="state === 3"> </p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ getCostCenterName(product.costCenter?.idCostCenter) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="measurementTypes"
                  optionLabel="name"
                  optionValue="idMeasurementType"
                  [(ngModel)]="product.measurementType.idMeasurementType"
                  [style]="{ width: '100%' }"
                  [disabled]="state === 3"> </p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ getMeasurementTypeName(product.measurementType?.idMeasurementType) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="priorities"
                  optionLabel="name"
                  optionValue="idPriority"
                  [(ngModel)]="product.priority.idPriority"
                  [style]="{ width: '100%' }"
                  [disabled]="state === 3"> </p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ getPriorityName(product.priority?.idPriority) }}
              </ng-template>
            </p-cellEditor>
          </td>

          <!-- <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.expectedGoal" type="number" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.expectedGoal }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.executedGoal" type="number" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.executedGoal }}</ng-template>
            </p-cellEditor>
          </td> -->

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.goods" type="number" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.goods }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.remuneration" type="number" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.remuneration }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.services" type="number" [disabled]="state === 3" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.services }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.goals[0].value" type="number"
                      [disabled]="state === 3 || (quarter !== null && 1 < quarter)" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.goals[0]?.value }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.goals[1].value" type="number"
                      [disabled]="state === 3 || (quarter !== null && 2 < quarter)" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.goals[1]?.value }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.goals[2].value" type="number"
                      [disabled]="state === 3 || (quarter !== null && 3 < quarter)" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.goals[2]?.value }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText [(ngModel)]="product.goals[3].value" type="number"
                      [disabled]="state === 3 || (quarter !== null && 4 < quarter)" />
              </ng-template>
              <ng-template pTemplate="output">{{ product.goals[3]?.value }}</ng-template>
            </p-cellEditor>
          </td>

          <td>
            <div class="flex items-center justify-center gap-2">
              <button
                *ngIf="!editing && state !== 3" pButton
                pRipple
                type="button"
                pInitEditableRow
                icon="pi pi-pencil"
                (click)="onRowEditInit(product)"
                text
                rounded
                severity="secondary">
              </button>

              <button
                *ngIf="editing" pButton
                pRipple
                type="button"
                pSaveEditableRow
                icon="pi pi-check"
                (click)="onRowEditSave(product)"
                text
                rounded
                severity="success">
              </button>

              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pCancelEditableRow
                icon="pi pi-times"
                (click)="onRowEditCancel(product, ri)"
                text
                rounded
                severity="danger">
              </button>

              <button
                *ngIf="!editing && state !== 3" pButton
                pRipple
                type="button"
                icon="pi pi-trash"
                (click)="eliminarActividad(ri, product)"
                text
                rounded
                severity="danger">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <div class="p-mb-4">
      <p-button
        label="Agregar Actividad"
        icon="pi pi-plus"
        (click)="agregarActividad()"
        severity="success"
        [disabled]="state === 3"> </p-button>
    </div>
  </div>
</div>
  <p-dialog header="Seleccionar Objetivo y Acción Estratégica" [(visible)]="displayOeAeModal" [modal]="true" [style]="{width: '90vw', height: '60%'}" [draggable]="true" [resizable]="true">
    <div class="p-fluid">
      <div class="p-field">
        <label for="strategicObjective">Objetivo Estratégico</label>
        <p-dropdown
          id="strategicObjective"
          [options]="strategicObjectives"
          optionLabel="name"
          optionValue="idStrategicObjective"
          [(ngModel)]="tempSelectedStrategicObjectiveId"
          (onChange)="onModalStrategicObjectiveChange($event)"
          placeholder="Selecciona un objetivo"
          [filter]="true"
          filterBy="name">
        </p-dropdown>
      </div>
      <div class="p-field mt-4">
        <label for="strategicAction">Acción Estratégica</label>
        <p-dropdown
          id="strategicAction"
          [options]="filteredStrategicActions"
          optionLabel="name"
          optionValue="idStrategicAction"
          [(ngModel)]="tempSelectedStrategicActionId"
          [disabled]="!tempSelectedStrategicObjectiveId"
          placeholder="Selecciona una acción"
          [filter]="true"
          filterBy="name">
        </p-dropdown>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <p-button label="Cancelar" icon="pi pi-times" (click)="cancelOeAeSelection()" styleClass="p-button-text"></p-button>
      <p-button label="Seleccionar" icon="pi pi-check" (click)="confirmOeAeSelection()"></p-button>
    </ng-template>
  </p-dialog>